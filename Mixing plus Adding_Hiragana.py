import re


# Part 1: Mixing verses..............................

from collections import defaultdict

def group_verses(text):
    # Use regular expression to find all matches of verse numbers and their texts
    pattern = re.compile(r'(\d+)([^\d]+)')
    matches = pattern.findall(text)
    
    # Create a dictionary to hold verses grouped by their number
    grouped_verses = defaultdict(list)
    
    # Iterate over the matches and group verses by number
    for number, verse in matches:
        grouped_verses[number].append(verse.strip())
    
    # Sort the dictionary by verse number
    sorted_verses = dict(sorted(grouped_verses.items(), key=lambda item: int(item[0])))
    
    # Combine grouped verses into a single string for each verse number
    combined_verses = []
    for number, verses in sorted_verses.items():
        # Add the first verse with its number
        combined_verses.append(f"{number}{verses[0]}")
        # Add the rest of the verses with a bullet
        combined_verses.extend([f"•{verse}" for verse in verses[1:]])
    
    return combined_verses

input_text = """

1イエスはオリーブ山(やま)へ行(い)かれた。 2朝早(あさはや)く、再(ふたた)び神殿(しんでん)の境内(けいだい)に入(はい)られると、民衆(みんしゅう)が皆(みな)、御自分(ごじぶん)のところにやって来(き)たので、座(すわ)って教(おし)え始(はじ)められた。 3そこへ、律法(りっぽう)学者(がくしゃ)たちやファリサイ派(は)の人々(ひとびと)が、姦通(かんつう)の現場(げんば)で捕(と)らえられた女(おんな)を連(つ)れて来(き)て、真(ま)ん中(なか)に立(た)たせ、 4イエスに言(い)った。「先生(せんせい)、この女(おんな)は姦通(かんつう)をしているときに捕(つか)まりました。 5こういう女(おんな)は石(いし)で打(う)ち殺(ころ)せと、モーセは律法(りっぽう)の中(なか)で命(めい)じています。ところで、あなたはどうお考(かんが)えになりますか。」 6イエスを試(ため)して、訴(うった)える口実(こうじつ)を得(え)るために、こう言(い)ったのである。イエスはかがみ込(こ)み、指(ゆび)で地面(じめん)に何(なに)か書(か)き始(はじ)められた。 7しかし、彼(かれ)らがしつこく問(と)い続(つづ)けるので、イエスは身(み)を起(お)こして言(い)われた。「あなたたちの中(なか)で罪(つみ)を犯(おか)したことのない者(もの)が、まず、この女(おんな)に石(いし)を投(な)げなさい。」 8そしてまた、身(み)をかがめて地面(じめん)に書(か)き続(つづ)けられた。 9これを聞(き)いた者(もの)は、年長者(ねんちょうしゃ)から始(はじ)まって、一人(ひとり)また一人(ひとり)と、立(た)ち去(さ)ってしまい、イエスひとりと、真(ま)ん中(なか)にいた女(おんな)が残(のこ)った。 10イエスは、身(み)を起(お)こして言(い)われた。「婦人(ふじん)よ、あの人(ひと)たちはどこにいるのか。だれもあなたを罪(つみ)に定(さだ)めなかったのか。」 11女(おんな)が、「主(しゅ)よ、だれも」と言(い)うと、イエスは言(い)われた。「わたしもあなたを罪(つみ)に定(さだ)めない。行(い)きなさい。これからは、もう罪(つみ)を犯(おか)してはならない。」〕
12イエスは再(ふたた)び言(い)われた。「わたしは世(よ)の光(ひかり)である。わたしに従(したが)う者(もの)は暗闇(くらやみ)の中(なか)を歩(ある)かず、命(いのち)の光(ひかり)を持(も)つ。」 13それで、ファリサイ派(は)の人々(ひとびと)が言(い)った。「あなたは自分(じぶん)について証(あか)しをしている。その証(あか)しは真実(しんじつ)ではない。」 14イエスは答(こた)えて言(い)われた。「たとえわたしが自分(じぶん)について証(あか)しをするとしても、その証(あか)しは真実(しんじつ)である。自分(じぶん)がどこから来(き)たのか、そしてどこへ行(い)くのか、わたしは知(し)っているからだ。しかし、あなたたちは、わたしがどこから来(き)てどこへ行(い)くのか、知(し)らない。 15あなたたちは肉(にく)に従(したが)って裁(さば)くが、わたしはだれをも裁(さば)かない。 16しかし、もしわたしが裁(さば)くとすれば、わたしの裁(さば)きは真実(しんじつ)である。なぜならわたしはひとりではなく、わたしをお遣(つか)わしになった父(ちち)と共(とも)にいるからである。 17あなたたちの律法(りっぽう)には、二人(ふたり)が行(おこな)う証(あか)しは真実(しんじつ)であると書(か)いてある。 18わたしは自分(じぶん)について証(あか)しをしており、わたしをお遣(つか)わしになった父(ちち)もわたしについて証(あか)しをしてくださる。」 19彼(かれ)らが「あなたの父(ちち)はどこにいるのか」と言(い)うと、イエスはお答(こた)えになった。「あなたたちは、わたしもわたしの父(ちち)も知(し)らない。もし、わたしを知(し)っていたら、わたしの父(ちち)をも知(し)るはずだ。」 20イエスは神殿(しんでん)の境内(けいだい)で教(おし)えておられたとき、宝物殿(ほうもつでん)の近(ちか)くでこれらのことを話(はな)された。しかし、だれもイエスを捕(と)らえなかった。イエスの時(とき)がまだ来(き)ていなかったからである。
21そこで、イエスはまた言(い)われた。「わたしは去(さ)って行(い)く。あなたたちはわたしを捜(さが)すだろう。だが、あなたたちは自分(じぶん)の罪(つみ)のうちに死(し)ぬことになる。わたしの行(い)く所(ところ)に、あなたたちは来(く)ることができない。」 22ユダヤ人(じん)たちが、「『わたしの行(い)く所(ところ)に、あなたたちは来(く)ることができない』と言(い)っているが、自殺(じさつ)でもするつもりなのだろうか」と話(はな)していると、 23イエスは彼(かれ)らに言(い)われた。「あなたたちは下(した)のものに属(ぞく)しているが、わたしは上(うえ)のものに属(ぞく)している。あなたたちはこの世(よ)に属(ぞく)しているが、わたしはこの世(よ)に属(ぞく)していない。 24だから、あなたたちは自分(じぶん)の罪(つみ)のうちに死(し)ぬことになると、わたしは言(い)ったのである。『わたしはある』ということを信(しん)じないならば、あなたたちは自分(じぶん)の罪(つみ)のうちに死(し)ぬことになる。」 25彼(かれ)らが、「あなたは、いったい、どなたですか」と言(い)うと、イエスは言(い)われた。「それは初(はじ)めから話(はな)しているではないか。 26あなたたちについては、言(い)うべきこと、裁(さば)くべきことがたくさんある。しかし、わたしをお遣(つか)わしになった方(かた)は真実(しんじつ)であり、わたしはその方(かた)から聞(き)いたことを、世(よ)に向(む)かって話(はな)している。」 27彼(かれ)らは、イエスが御父(おんちち)について話(はな)しておられることを悟(さと)らなかった。 28そこで、イエスは言(い)われた。「あなたたちは、人(ひと)の子(こ)を上(あ)げたときに初(はじ)めて、『わたしはある』ということ、また、わたしが、自分勝手(じぶんかって)には何(なに)もせず、ただ、父(ちち)に教(おし)えられたとおりに話(はな)していることが分(わ)かるだろう。 29わたしをお遣(つか)わしになった方(かた)は、わたしと共(とも)にいてくださる。わたしをひとりにしてはおかれない。わたしは、いつもこの方(かた)の御心(みこころ)に適(かな)うことを行(おこな)うからである。」 30これらのことを語(かた)られたとき、多(おお)くの人々(ひとびと)がイエスを信(しん)じた。
31イエスは、御自分(ごじぶん)を信(しん)じたユダヤ人(じん)たちに言(い)われた。「わたしの言葉(ことば)にとどまるならば、あなたたちは本当(ほんとう)にわたしの弟子(でし)である。 32あなたたちは真(しん)理(り)を知(し)り、真理(しんり)はあなたたちを自由(じゆう)にする。」 33すると、彼(かれ)らは言(い)った。「わたしたちはアブラハムの子孫(しそん)です。今(いま)までだれかの奴隷(どれい)になったことはありません。『あなたたちは自由(じゆう)になる』とどうして言(い)われるのですか。」 34イエスはお答(こた)えになった。「はっきり言(い)っておく。罪(つみ)を犯(おか)す者(もの)はだれでも罪(つみ)の奴隷(どれい)である。 35奴隷(どれい)は家(いえ)にいつまでもいるわけにはいかないが、子(こ)はいつまでもいる。 36だから、もし子(こ)があなたたちを自由(じゆう)にすれば、あなたたちは本当(ほんとう)に自由(じゆう)になる。 37あなたたちがアブラハムの子孫(しそん)だということは、分(わ)かっている。だが、あなたたちはわたしを殺(ころ)そうとしている。わたしの言葉(ことば)を受(う)け入(い)れないからである。 38わたしは父(ちち)のもとで見(み)たことを話(はな)している。ところが、あなたたちは父(ちち)から聞(き)いたことを行(おこな)っている。」
39彼(かれ)らが答(こた)えて、「わたしたちの父(ちち)はアブラハムです」と言(い)うと、イエスは言(い)われた。「アブラハムの子(こ)なら、アブラハムと同(おな)じ業(わざ)をするはずだ。 40ところが、今(いま)、あなたたちは、神(かみ)から聞(き)いた真理(しんり)をあなたたちに語(かた)っているこのわたしを、殺(ころ)そうとしている。アブラハムはそんなことはしなかった。 41あなたたちは、自分(じぶん)の父(ちち)と同(おな)じ業(わざ)をしている。」そこで彼(かれ)らが、「わたしたちは姦淫(かんいん)によって生(う)まれたのではありません。わたしたちにはただひとりの父(ちち)がいます。それは神(かみ)です」と言(い)うと、 42イエスは言(い)われた。「神(かみ)があなたたちの父(ちち)であれば、あなたたちはわたしを愛(あい)するはずである。なぜなら、わたしは神(かみ)のもとから来(き)て、ここにいるからだ。わたしは自分勝手(じぶんかって)に来(き)たのではなく、神(かみ)がわたしをお遣(つか)わしになったのである。 43わたしの言(い)っていることが、なぜ分(わ)からないのか。それは、わたしの言葉(ことば)を聞(き)くことができないからだ。 44あなたたちは、悪魔(あくま)である父(ちち)から出(で)た者(もの)であって、その父(ちち)の欲望(よくぼう)を満(み)たしたいと思(おも)っている。悪魔(あくま)は最初(さいしょ)から人殺(ひとごろ)しであって、真理(しんり)をよりどころとしていない。彼(かれ)の内(うち)には真理(しんり)がないからだ。悪魔(あくま)が偽(いつわ)りを言(い)うときは、その本性(ほんせい)から言(い)っている。自分(じぶん)が偽(いつわ)り者(もの)であり、その父(ちち)だからである。 45しかし、わたしが真理(しんり)を語(かた)るから、あなたたちはわたしを信(しん)じない。 46あなたたちのうち、いったいだれが、わたしに罪(つみ)があると責(せ)めることができるのか。わたしは真理(しんり)を語(かた)っているのに、なぜわたしを信(しん)じないのか。 47神(かみ)に属(ぞく)する者(もの)は神(かみ)の言葉(ことば)を聞(き)く。あなたたちが聞(き)かないのは神(かみ)に属(ぞく)していないからである。」
48ユダヤ人(じん)たちが、「あなたはサマリア人(じん)で悪霊(あくれい)に取(と)りつかれていると、我々(われわれ)が言(い)うのも当然(とうぜん)ではないか」と言(い)い返(かえ)すと、 49イエスはお答(こた)えになった。「わたしは悪霊(あくれい)に取(と)りつかれてはいない。わたしは父(ちち)を重(おも)んじているのに、あなたたちはわたしを重(おも)んじない。 50わたしは、自分(じぶん)の栄光(えいこう)は求(もと)めていない。わたしの栄光(えいこう)を求(もと)め、裁(さば)きをなさる方(かた)が、ほかにおられる。 51はっきり言(い)っておく。わたしの言葉(ことば)を守(まも)るなら、その人(ひと)は決(けっ)して死(し)ぬことがない。」 52ユダヤ人(じん)たちは言(い)った。「あなたが悪霊(あくれい)に取(と)りつかれていることが、今(いま)はっきりした。アブラハムは死(し)んだし、預言者(よげんしゃ)たちも死(し)んだ。ところが、あなたは、『わたしの言葉(ことば)を守(まも)るなら、その人(ひと)は決(けっ)して死(し)を味(あじ)わうことがない』と言(い)う。 53わたしたちの父(ちち)アブラハムよりも、あなたは偉大(いだい)なのか。彼(かれ)は死(し)んだではないか。預言者(よげんしゃ)たちも死(し)んだ。いったい、あなたは自分(じぶん)を何者(なにもの)だと思(おも)っているのか。」 54イエスはお答(こた)えになった。「わたしが自分(じぶん)自身(じしん)のために栄光(えいこう)を求(もと)めようとしているのであれば、わたしの栄光(えいこう)はむなしい。わたしに栄光(えいこう)を与(あた)えてくださるのはわたしの父(ちち)であって、あなたたちはこの方(かた)について、『我々(われわれ)の神(かみ)だ』と言(い)っている。 55あなたたちはその方(かた)を知(し)らないが、わたしは知(し)っている。わたしがその方(かた)を知(し)らないと言(い)えば、あなたたちと同(おな)じくわたしも偽(いつわ)り者(もの)になる。しかし、わたしはその方(かた)を知(し)っており、その言葉(ことば)を守(まも)っている。 56あなたたちの父(ちち)アブラハムは、わたしの日(ひ)を見(み)るのを楽(たの)しみにしていた。そして、それを見(み)て、喜(よろこ)んだのである。」 57ユダヤ人(じん)たちが、「あなたは、まだ五十歳(さい)にもならないのに、アブラハムを見(み)たのか」と言(い)うと、 58イエスは言(い)われた。「はっきり言(い)っておく。アブラハムが生(う)まれる前(まえ)から、『わたしはある。』」 59すると、ユダヤ人(じん)たちは、石(いし)を取(と)り上(あ)げ、イエスに投(な)げつけようとした。しかし、イエスは身(み)を隠(かく)して、神殿(しんでん)の境内(けいだい)から出(で)て行(い)かれた。

1眾人都回家去了，耶穌卻上了橄欖山。 2 第二天清晨，祂又回到聖殿。百姓聚集在祂那裡，祂就坐下來教導他們。 3 這時候，律法教師和法利賽人帶來一個通姦時被捉的女人，讓她站在眾人面前， 4 然後問耶穌：「老師，這個女人是在通姦時被捉到的。 5 按摩西的律法，我們要用石頭把她打死，你說該怎麼處置她呢？」
6 他們這樣問是要使耶穌落在他們的圈套裡，可以有藉口控告祂。耶穌卻只是彎著腰用指頭在地上寫字。 7 他們不斷地追問耶穌，於是祂直起腰來，對他們說：「你們中間誰沒有罪，誰就先拿石頭打她吧。」 8 說完，又彎下腰在地上寫字。
9 他們聽了這句話，就從老到少一個一個地走了，只剩下耶穌和那個女人在那裡。 10 耶穌直起腰來，說：「婦人，他們到哪裡去了？沒有人定你的罪嗎？」
11 她說：「主啊，沒有。」
耶穌說：「我也不定你的罪。回去吧，從今以後不要再犯罪了。」
12 耶穌又對眾人說：「我是世界的光，凡跟從我的，必不會走在黑暗裡，必要得到生命的光。」
13 法利賽人對祂說：「你自己為自己做見證，你的見證不真實。」
14 耶穌說：「即便我自己為自己做見證，我的見證仍是真實的，因為我知道自己從哪裡來、要到哪裡去，你們卻不知道我從哪裡來、要到哪裡去。 15 你們只憑外表判斷別人，我卻不判斷人。 16 就算我判斷人，我的判斷也是正確的，因為我不是獨自一人，還有差我來的父與我同在。 17 你們的律法不是說兩個人做見證就有效嗎？ 18 我是自己為自己做見證，差我來的父也為我做見證。」
19 他們問：「你的父在哪裡？」
耶穌回答說：「你們不認識我，也不認識我的父。如果你們認識我，也會認識我的父。」 20 耶穌在聖殿的庫房這樣教導人，但沒有人抓祂，因為祂的時候還沒有到。
21 耶穌又對他們說：「我要走了，你們會尋找我，你們將死在自己的罪中。我去的地方，你們不能去。」
22 猶太人說：「祂說祂去的地方我們不能去，難道祂想自殺嗎？」
23 耶穌對他們說：「你們是從下面來的，我是從上面來的。你們屬於這世界，我不屬於這世界。 24 所以我說你們將死在自己的罪中，你們如果不相信我就是[a]那一位，一定會死在自己的罪中。」
25 他們問：「你到底是誰？」
耶穌回答說：「我不是早就告訴你們了嗎？ 26 關於你們，我有許多要說、要審判的，但差我來的那位是真實的，我把從祂那裡聽到的告訴世人。」 27 他們不明白耶穌是指著父說的。
28 於是耶穌說：「你們舉起人子以後，必知道我就是那一位，並且知道我沒有一件事是憑自己做的，我所說的都是父教導我的。 29 差我來的那位跟我在一起，祂沒有撇下我，讓我孤單一人，因為我做的都是祂所喜悅的。」 30 許多人因為這番話而信了耶穌。
31 耶穌對信祂的猶太人說：「你們若持守我的道，就真是我的門徒了。 32 你們必認識真理，真理必叫你們得到自由。」
33 他們說：「我們是亞伯拉罕的子孫，從來沒有做過奴隸，你為什麼說我們可以得到自由呢？」
34 耶穌說：「我實實在在地告訴你們，所有犯罪的人都是罪的奴隸。 35 奴隸不能永遠留在主人的家裡，只有兒子才可以。 36 所以，如果上帝的兒子釋放了你們，你們就真正自由了！
37 「我知道你們是亞伯拉罕的子孫，但你們卻想殺我，因為你們心裡容不下我的道。 38 我所說的，是我從父那裡看到的，你們卻照著你們父[b]的話去做。」
39 他們說：「我們的父就是亞伯拉罕！」
耶穌說：「你們如果真是亞伯拉罕的子孫，一定會做他所做的事。 40 我把從上帝那裡聽到的真理告訴你們，你們反要殺我，亞伯拉罕絕不做這樣的事。 41 你們是在作你們父所做的事。」
他們說：「我們不是從淫亂生的！我們只有一位父，就是上帝。」
42 耶穌說：「如果上帝是你們的父，你們一定會愛我，因為我來自上帝。如今我在這裡，我不是憑自己來的，而是上帝差我來的， 43 你們為什麼不明白我的話呢？因為你們聽不進去我的道。 44 你們是出於你們的父魔鬼，你們樂意順著牠的私慾行。魔鬼從起初就是個殺人兇手，從不站在真理這一邊，因為牠心裡根本沒有真理。撒謊是牠的本性，因為牠是撒謊者，又是撒謊者的始祖。 45 所以，我講真理的時候，你們不信我。 46 你們誰能指證我有罪呢？我既然把真理告訴了你們，你們為什麼還不信我呢？ 47 出於上帝的人聽上帝的話，你們不聽上帝的話，因為你們不是出於上帝。」
48 猶太人對(駡？)祂說：「我們說你是撒瑪利亞人[c]，被鬼附身了，難道不對嗎？」
49 耶穌說：「我沒有被鬼附身。我尊敬我的父，你們卻侮辱我。 50 我不為自己尋求榮耀，但有一位會為我尋求，祂也會斷定誰是誰非。 51 我實實在在地告訴你們，人如果遵行我的道，必永遠不死。」
52 那些猶太人說：「現在我們的確知道你是被鬼附身了！亞伯拉罕和眾先知都死了，你還說人如果遵行你的道，必永遠不死。 53 難道你比我們的祖先亞伯拉罕還大嗎？他死了，先知們也死了，你以為你是誰？」
54 耶穌說：「如果我為自己爭取榮耀，那榮耀算不了什麼。但使我得榮耀的是我的父，你們也稱祂為你們的上帝。 55 你們不認識祂，我卻認識祂。如果我說我不認識祂，那我就像你們一樣是說謊的。然而，我認識祂，並且遵行祂的道。 56 你們的祖先亞伯拉罕曾經歡歡喜喜地盼望看到我來的日子。他看見了，就歡喜快樂。」
57 猶太人說：「你還不到五十歲，怎麼會見過亞伯拉罕呢？」
58 耶穌說：「我實實在在地告訴你們，亞伯拉罕還沒有出生，我就已經存在了[d]。」 59 於是，他們就拿起石頭要打祂，耶穌卻避開他們，離開了聖殿。





"""

grouped_verses = group_verses(input_text)



# Part 2: Adding Hiragana and font size function...................



# Define a function to transform text based on the specified rules
def transform_text(text):
    # Rule 1: Prepend "XXX" before any number
    text = re.sub(r'(\d+)', r'XXX\1', text)

    # Rule 3: Prepend "YYY" before any bullet symbol (•)
    text = text.replace('•', 'YYY•')

    # Rule 2: Replace Kanji expressions followed by content in parenthesis
    def replace_kanji(match):
        kanji_expression = match.group(1)
        content = match.group(2)
        return f'ZZZ{content}AAA{kanji_expression}BBB'

    # Apply Rule 2 within the content between a number and a bullet
    kanji_pattern = r'([\u4e00-\u9faf]+)\(([^)]+)\)'
    text = re.sub(kanji_pattern, replace_kanji, text)

    # Replace placeholders with the specified HTML content
    text = text.replace('XXX', '</div></div></div><div class="hierarchy-item"> <span class="toggle">➕</span>')
    text = text.replace('ZZZ', '<span class="hiragana" data-hiragana="')
    text = text.replace('AAA', '" onclick="showHiragana(this)">')
    text = text.replace('BBB', '</span>')
    text = text.replace('YYY', '<div class="sub-items"> <div class="hierarchy-item">')

    return text

# Example usage
input_text = ' '.join(grouped_verses)
output_text = transform_text(input_text)
print(f"Transformed text:\n{output_text}")

with open("C:/Users/pablo/OneDrive/Documentos/Bible/Bible Jap/Bible-Jap/MyFile.txt", "w", encoding='utf-8') as f:
    f.write(output_text)